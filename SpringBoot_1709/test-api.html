<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test API - OneShop</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-5">
      <h1 class="mb-4">Test API OneShop</h1>

      <!-- Category Tests -->
      <div class="card mb-4">
        <div class="card-header">
          <h5><i class="fas fa-tags me-2"></i>Category API Tests</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <button
                class="btn btn-primary mb-2"
                onclick="testGetAllCategories()"
              >
                <i class="fas fa-list me-1"></i>Get All Categories
              </button>
              <button class="btn btn-success mb-2" onclick="testAddCategory()">
                <i class="fas fa-plus me-1"></i>Add Category
              </button>
              <button
                class="btn btn-warning mb-2"
                onclick="testUpdateCategory()"
              >
                <i class="fas fa-edit me-1"></i>Update Category
              </button>
              <button
                class="btn btn-danger mb-2"
                onclick="testDeleteCategory()"
              >
                <i class="fas fa-trash me-1"></i>Delete Category
              </button>
            </div>
            <div class="col-md-6">
              <div id="categoryResult" class="alert alert-info">
                <strong>Category API Results:</strong><br />
                <div id="categoryOutput">Click a button to test...</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Product Tests -->
      <div class="card mb-4">
        <div class="card-header">
          <h5><i class="fas fa-box me-2"></i>Product API Tests</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <button
                class="btn btn-primary mb-2"
                onclick="testGetAllProducts()"
              >
                <i class="fas fa-list me-1"></i>Get All Products
              </button>
              <button class="btn btn-success mb-2" onclick="testAddProduct()">
                <i class="fas fa-plus me-1"></i>Add Product
              </button>
              <button
                class="btn btn-warning mb-2"
                onclick="testUpdateProduct()"
              >
                <i class="fas fa-edit me-1"></i>Update Product
              </button>
              <button class="btn btn-danger mb-2" onclick="testDeleteProduct()">
                <i class="fas fa-trash me-1"></i>Delete Product
              </button>
            </div>
            <div class="col-md-6">
              <div id="productResult" class="alert alert-info">
                <strong>Product API Results:</strong><br />
                <div id="productOutput">Click a button to test...</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Test Results -->
      <div class="card">
        <div class="card-header">
          <h5><i class="fas fa-chart-line me-2"></i>Test Results</h5>
        </div>
        <div class="card-body">
          <div id="testResults">
            <p class="text-muted">Run tests to see results here...</p>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const API_BASE = "http://localhost:8089/api";
      let testCategoryId = null;
      let testProductId = null;

      // Category API Tests
      async function testGetAllCategories() {
        try {
          const response = await fetch(`${API_BASE}/category`);
          const data = await response.json();
          document.getElementById(
            "categoryOutput"
          ).innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
          logTest("Get All Categories", response.ok, data);
        } catch (error) {
          document.getElementById(
            "categoryOutput"
          ).innerHTML = `Error: ${error.message}`;
          logTest("Get All Categories", false, error.message);
        }
      }

      async function testAddCategory() {
        try {
          const formData = new FormData();
          formData.append("categoryName", "Test Category " + Date.now());

          const response = await fetch(`${API_BASE}/category/addCategory`, {
            method: "POST",
            body: formData,
          });
          const data = await response.json();
          document.getElementById(
            "categoryOutput"
          ).innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;

          if (data.success && data.data) {
            testCategoryId = data.data.categoryId;
          }
          logTest("Add Category", response.ok, data);
        } catch (error) {
          document.getElementById(
            "categoryOutput"
          ).innerHTML = `Error: ${error.message}`;
          logTest("Add Category", false, error.message);
        }
      }

      async function testUpdateCategory() {
        if (!testCategoryId) {
          alert("Please add a category first");
          return;
        }

        try {
          const formData = new FormData();
          formData.append("categoryId", testCategoryId);
          formData.append("categoryName", "Updated Category " + Date.now());

          const response = await fetch(`${API_BASE}/category/updateCategory`, {
            method: "POST",
            body: formData,
          });
          const data = await response.json();
          document.getElementById(
            "categoryOutput"
          ).innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
          logTest("Update Category", response.ok, data);
        } catch (error) {
          document.getElementById(
            "categoryOutput"
          ).innerHTML = `Error: ${error.message}`;
          logTest("Update Category", false, error.message);
        }
      }

      async function testDeleteCategory() {
        if (!testCategoryId) {
          alert("Please add a category first");
          return;
        }

        try {
          const formData = new FormData();
          formData.append("categoryId", testCategoryId);

          const response = await fetch(`${API_BASE}/category/deleteCategory`, {
            method: "POST",
            body: formData,
          });
          const data = await response.json();
          document.getElementById(
            "categoryOutput"
          ).innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
          logTest("Delete Category", response.ok, data);
          testCategoryId = null;
        } catch (error) {
          document.getElementById(
            "categoryOutput"
          ).innerHTML = `Error: ${error.message}`;
          logTest("Delete Category", false, error.message);
        }
      }

      // Product API Tests
      async function testGetAllProducts() {
        try {
          const response = await fetch(`${API_BASE}/product`);
          const data = await response.json();
          document.getElementById(
            "productOutput"
          ).innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
          logTest("Get All Products", response.ok, data);
        } catch (error) {
          document.getElementById(
            "productOutput"
          ).innerHTML = `Error: ${error.message}`;
          logTest("Get All Products", false, error.message);
        }
      }

      async function testAddProduct() {
        try {
          // First get a category
          const categoryResponse = await fetch(`${API_BASE}/category`);
          const categoryData = await categoryResponse.json();

          if (
            !categoryData.success ||
            !categoryData.data ||
            categoryData.data.length === 0
          ) {
            alert("No categories available. Please add a category first.");
            return;
          }

          const formData = new FormData();
          formData.append("productName", "Test Product " + Date.now());
          formData.append("description", "Test product description");
          formData.append("price", "100000");
          formData.append("stockQuantity", "10");
          formData.append("categoryId", categoryData.data[0].categoryId);

          const response = await fetch(`${API_BASE}/product/addProduct`, {
            method: "POST",
            body: formData,
          });
          const data = await response.json();
          document.getElementById(
            "productOutput"
          ).innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;

          if (data.success && data.data) {
            testProductId = data.data.productId;
          }
          logTest("Add Product", response.ok, data);
        } catch (error) {
          document.getElementById(
            "productOutput"
          ).innerHTML = `Error: ${error.message}`;
          logTest("Add Product", false, error.message);
        }
      }

      async function testUpdateProduct() {
        if (!testProductId) {
          alert("Please add a product first");
          return;
        }

        try {
          const formData = new FormData();
          formData.append("productId", testProductId);
          formData.append("productName", "Updated Product " + Date.now());
          formData.append("description", "Updated product description");
          formData.append("price", "150000");
          formData.append("stockQuantity", "20");
          formData.append("categoryId", "1"); // Assuming category 1 exists

          const response = await fetch(`${API_BASE}/product/updateProduct`, {
            method: "POST",
            body: formData,
          });
          const data = await response.json();
          document.getElementById(
            "productOutput"
          ).innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
          logTest("Update Product", response.ok, data);
        } catch (error) {
          document.getElementById(
            "productOutput"
          ).innerHTML = `Error: ${error.message}`;
          logTest("Update Product", false, error.message);
        }
      }

      async function testDeleteProduct() {
        if (!testProductId) {
          alert("Please add a product first");
          return;
        }

        try {
          const formData = new FormData();
          formData.append("productId", testProductId);

          const response = await fetch(`${API_BASE}/product/deleteProduct`, {
            method: "POST",
            body: formData,
          });
          const data = await response.json();
          document.getElementById(
            "productOutput"
          ).innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
          logTest("Delete Product", response.ok, data);
          testProductId = null;
        } catch (error) {
          document.getElementById(
            "productOutput"
          ).innerHTML = `Error: ${error.message}`;
          logTest("Delete Product", false, error.message);
        }
      }

      function logTest(testName, success, data) {
        const resultsDiv = document.getElementById("testResults");
        const timestamp = new Date().toLocaleTimeString();
        const statusClass = success ? "text-success" : "text-danger";
        const statusIcon = success ? "✓" : "✗";

        const testResult = document.createElement("div");
        testResult.className = `mb-2 p-2 border rounded ${
          success ? "border-success" : "border-danger"
        }`;
        testResult.innerHTML = `
                <div class="d-flex justify-content-between">
                    <span class="${statusClass}">
                        <i class="fas fa-${
                          success ? "check" : "times"
                        } me-1"></i>
                        ${testName}
                    </span>
                    <small class="text-muted">${timestamp}</small>
                </div>
                <small class="text-muted">${
                  success ? "Success" : "Failed"
                }</small>
            `;

        resultsDiv.insertBefore(testResult, resultsDiv.firstChild);
      }
    </script>
  </body>
</html>
